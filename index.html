<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ü•æ UGG Ï£ºÎ¨∏ÏÑú</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #FAF7F2 0%, #F5EFE6 100%);
      font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, sans-serif;
      padding: 20px;
    }
    @media print {
      .no-print { display: none !important; }
      body { background: white !important; }
    }
    .size-btn {
      transition: all 0.15s ease;
      cursor: pointer;
      user-select: none;
    }
    .size-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .size-btn.selected {
      background: #1a1a1a !important;
      color: white !important;
      border-color: #1a1a1a !important;
    }
    .product-card {
      transition: all 0.2s ease;
      max-width: 308px;
    }
    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
    }
    .btn-primary {
      background: linear-gradient(135deg, #2C2C2C 0%, #1a1a1a 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .btn-secondary {
      background: white;
      color: #333;
      border: 2px solid #ddd;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .btn-secondary:hover {
      border-color: #999;
    }
    .input-field {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 15px;
      transition: border-color 0.2s;
      background: white;
      font-family: inherit;
    }
    .input-field:focus {
      outline: none;
      border-color: #666;
    }
    .qty-input {
      width: 50px;
      text-align: center;
      padding: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 13px;
    }
    .image-upload-zone {
      border: 2px dashed #ccc;
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      background: rgba(255,255,255,0.5);
      margin-bottom: 12px;
      min-height: 100px;
    }
    .image-upload-zone:hover {
      border-color: #888;
      background: rgba(255,255,255,0.8);
    }
    .image-upload-zone.has-image {
      border-style: solid;
      padding: 0;
      overflow: hidden;
      min-height: auto;
      max-width: 100%;
      height: auto;
      max-height: 280px;
      background: #f9f9f9;
    }
    .product-image {
      width: 450px;
      height: 300px;
      object-fit: contain;
      max-width: 100%;
      cursor: pointer;
      transition: transform 0.2s;
      background: #f9f9f9;
      border-radius: 8px;
    }
    .product-image:hover {
      transform: scale(1.02);
    }
    .remove-image-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: rgba(0,0,0,0.6);
      color: white;
      border: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .remove-image-btn:hover {
      background: rgba(220,53,69,0.9);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Îã§Íµ≠Ïñ¥ Î≤àÏó≠ Îç∞Ïù¥ÌÑ∞
    const TRANSLATIONS = {
      ko: {
        title: 'ü•æ UGG Ï£ºÎ¨∏ÏÑú',
        subtitle: 'Ï†úÌíàÏùÑ ÌÅ¥Î¶≠ÌïòÏó¨ Ï£ºÎ¨∏ ÏàòÎüâÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî',
        imageUpload: 'Ïù¥ÎØ∏ÏßÄ Ï≤®Î∂Ä Í∞ÄÎä•',
        reset: 'Ï¥àÍ∏∞Ìôî',
        history: 'ÌûàÏä§ÌÜ†Î¶¨',
        save: 'Ï†ÄÏû•',
        print: 'Ïù∏ÏáÑ',
        excel: 'ÏóëÏÖÄ',
        share: 'URL Í≥µÏú†',
        clientInfo: 'Í±∞ÎûòÏ≤ò Ï†ïÎ≥¥',
        clientName: 'Í±∞ÎûòÏ≤òÎ™Ö',
        contact: 'Ïó∞ÎùΩÏ≤ò',
        orderDate: 'Ï£ºÎ¨∏Ïùº',
        notes: 'ÎπÑÍ≥†',
        shipping: 'Î∞∞ÏÜ° Ï†ïÎ≥¥',
        sender: 'Î∞úÏÜ°ÏßÄ Ï£ºÏÜå',
        receiver: 'ÎèÑÏ∞©ÏßÄ Ï£ºÏÜå',
        orderSummary: 'Ï£ºÎ¨∏ ÏöîÏïΩ',
        photo: 'ÏÇ¨ÏßÑ',
        sku: 'ÌíàÎ≤à',
        productName: 'Ï†úÌíàÎ™Ö',
        color: 'Ïª¥Îü¨',
        sizeQty: 'ÏÇ¨Ïù¥Ï¶à(mm) √ó ÏàòÎüâ',
        subtotal: 'ÏÜåÍ≥Ñ',
        delete: 'ÏÇ≠Ï†ú',
        totalQty: 'Ï¥ù Ï£ºÎ¨∏ ÏàòÎüâ',
        clickToAddPhoto: 'ÌÅ¥Î¶≠ÌïòÏó¨ Ï†úÌíà ÏÇ¨ÏßÑ Ï∂îÍ∞Ä',
        enterClientName: 'Í±∞ÎûòÏ≤òÎ™Ö ÏûÖÎ†•',
        enterContact: 'Ïó∞ÎùΩÏ≤ò ÏûÖÎ†•',
        enterNotes: 'Î©îÎ™® ÏûÖÎ†•',
        enterSender: 'Î∞úÏÜ°ÏßÄ Ï£ºÏÜå ÏûÖÎ†•',
        enterReceiver: 'ÎèÑÏ∞©ÏßÄ Ï£ºÏÜå ÏûÖÎ†•',
      },
      en: {
        title: 'ü•æ UGG Order Form',
        subtitle: 'Click on products to select order quantity',
        imageUpload: 'Image upload available',
        reset: 'Reset',
        history: 'History',
        save: 'Save',
        print: 'Print',
        excel: 'Excel',
        share: 'Share URL',
        clientInfo: 'Client Information',
        clientName: 'Client Name',
        contact: 'Contact',
        orderDate: 'Order Date',
        notes: 'Notes',
        shipping: 'Shipping Information',
        sender: 'Sender Address',
        receiver: 'Receiver Address',
        orderSummary: 'Order Summary',
        photo: 'Photo',
        sku: 'SKU',
        productName: 'Product Name',
        color: 'Color',
        sizeQty: 'Size(mm) √ó Qty',
        subtotal: 'Subtotal',
        delete: 'Delete',
        totalQty: 'Total Quantity',
        clickToAddPhoto: 'Click to add product photo',
        enterClientName: 'Enter client name',
        enterContact: 'Enter contact',
        enterNotes: 'Enter notes',
        enterSender: 'Enter sender address',
        enterReceiver: 'Enter receiver address',
      },
      cn: {
        title: 'ü•æ UGG ËÆ¢Âçï',
        subtitle: 'ÁÇπÂáª‰∫ßÂìÅÈÄâÊã©ËÆ¢ÂçïÊï∞Èáè',
        imageUpload: 'ÂèØ‰∏ä‰º†ÂõæÁâá',
        reset: 'ÈáçÁΩÆ',
        history: 'ÂéÜÂè≤ËÆ∞ÂΩï',
        save: '‰øùÂ≠ò',
        print: 'ÊâìÂç∞',
        excel: 'Excel',
        share: 'ÂàÜ‰∫´URL',
        clientInfo: 'ÂÆ¢Êà∑‰ø°ÊÅØ',
        clientName: 'ÂÆ¢Êà∑ÂêçÁß∞',
        contact: 'ËÅîÁ≥ªÊñπÂºè',
        orderDate: 'ËÆ¢ÂçïÊó•Êúü',
        notes: 'Â§áÊ≥®',
        shipping: 'ÈÖçÈÄÅ‰ø°ÊÅØ',
        sender: 'Âèë‰ª∂‰∫∫Âú∞ÂùÄ',
        receiver: 'Êî∂‰ª∂‰∫∫Âú∞ÂùÄ',
        orderSummary: 'ËÆ¢ÂçïÊ¶ÇË¶Å',
        photo: 'ÁÖßÁâá',
        sku: '‰∫ßÂìÅÁºñÂè∑',
        productName: '‰∫ßÂìÅÂêçÁß∞',
        color: 'È¢úËâ≤',
        sizeQty: 'Â∞∫Á†Å(mm) √ó Êï∞Èáè',
        subtotal: 'Â∞èËÆ°',
        delete: 'Âà†Èô§',
        totalQty: 'ÊÄªÊï∞Èáè',
        clickToAddPhoto: 'ÁÇπÂáªÊ∑ªÂä†‰∫ßÂìÅÁÖßÁâá',
        enterClientName: 'ËæìÂÖ•ÂÆ¢Êà∑ÂêçÁß∞',
        enterContact: 'ËæìÂÖ•ËÅîÁ≥ªÊñπÂºè',
        enterNotes: 'ËæìÂÖ•Â§áÊ≥®',
        enterSender: 'ËæìÂÖ•Âèë‰ª∂‰∫∫Âú∞ÂùÄ',
        enterReceiver: 'ËæìÂÖ•Êî∂‰ª∂‰∫∫Âú∞ÂùÄ',
      }
    };

    // US ÏÇ¨Ïù¥Ï¶à ‚Üí ÌïúÍµ≠ ÏÇ¨Ïù¥Ï¶à Îß§Ìïë
    const US_TO_KR = {
      5: 220, 6: 230, 7: 240, 8: 250, 9: 260, 10: 270, 11: 280, 12: 290
    };

    const UGG_PRODUCTS = [
      { sku: '1122550-CHE', name: 'ÎîîÏä§ÏºÄÌä∏ Ïä¨Î¶¨Ìçº', color: 'Ï≤¥Ïä§Ìä∏ÎÑõ', category: 'Slipper', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1UDU_SIgfss6LZAdLUVXloLr1IbzsvKqg&sz=w1000' },
      { sku: '1135092-CHE', name: 'ÌÅ¥ÎûòÏãù Ïö∏Ìä∏Îùº ÎØ∏Îãà ÌîåÎû´Ìèº', color: 'Ï≤¥Ïä§Ìä∏ÎÑõ', category: 'Platform', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=11Grug5101dEnBH5dS6uAYNBacxsbUVgj&sz=w1000' },
      { sku: '1122553-CHE', name: 'ÌÉÄÏ¶à Ïä¨Î¶¨Ìçº', color: 'Ï≤¥Ïä§Ìä∏ÎÑõ', category: 'Slipper', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1ggACezQSWGxolTQKjQhR6s0E0myfT75t&sz=w1000' },
      { sku: '1119002-CHE', name: 'ÎãàÌÉÄ Ïä¨Î¶¨Ìçº', color: 'Ï≤¥Ïä§Ìä∏ÎÑõ', category: 'Slipper', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1YAM3Zz6BmQqK254diRudv2nIuO196NBX&sz=w1000' },
      { sku: '1016422-CHE', name: 'ÎØ∏Îãà Î≤†ÏùºÎ¶¨ Î≤ÑÌäº II Î∂ÄÏ∏†', color: 'Ï≤¥Ïä§Ìä∏ÎÑõ', category: 'Classic', sizes: [5,6,7,8,9,10,11], imageUrl: 'https://drive.google.com/thumbnail?id=1zcFa6oTCU2m9ULuqww6OoutyLx3exsA5&sz=w1000' },
      { sku: '1016501-GREY', name: 'W ÎØ∏Îãà Î≤†ÏùºÎ¶¨ Î≥¥Ïö∞ II Î∂ÄÏ∏†', color: 'Í∑∏Î†àÏù¥', category: 'Classic', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1vrPqVQxm5Juy61Mzwl51b5MWZBCFLrmE&sz=w1000' },
      { sku: '1016223-CHE', name: 'ÌÅ¥ÎûòÏãù Ïàè II Î∂ÄÏ∏†', color: 'Ï≤¥Ïä§Ìä∏ÎÑõ', category: 'Classic', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1QKUCfq0PK2qwcqDbpa_iTaBQdc-wxRtG&sz=w1000' },
      { sku: '1016223-BLK', name: 'ÌÅ¥ÎûòÏãù Ïàè II Î∂ÄÏ∏†', color: 'Î∏îÎûô', category: 'Classic', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1GS56OSyW-ERZvMVyaiQY6FGc0bSOnX1F&sz=w1000' },
      { sku: '1016223-GREY', name: 'ÌÅ¥ÎûòÏãù Ïàè II Î∂ÄÏ∏†', color: 'Í∑∏Î†àÏù¥', category: 'Classic', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1ZXtnNqoEhXIvoxA4vWZRCiwRyRX64IJ6&sz=w1000' },
      { sku: '1116109-CHE', name: 'ÌÅ¥ÎûòÏãù Ïö∏Ìä∏Îùº ÎØ∏Îãà Î∂ÄÏ∏†', color: 'Ï≤¥Ïä§Ìä∏ÎÑõ', category: 'Classic', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1quLctoRUJO0LOrDS4zGpoeXphKVDyeCr&sz=w1000' },
      { sku: '1016222-GREY', name: 'ÌÅ¥ÎûòÏãù ÎØ∏Îãà II Î∂ÄÏ∏†', color: 'Í∑∏Î†àÏù¥', category: 'Classic', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1g65VySinjC6WImuazL9rnt_vHOM6SrtG&sz=w1000' },
      { sku: '1016222-BLK', name: 'ÌÅ¥ÎûòÏãù ÎØ∏Îãà II Î∂ÄÏ∏†', color: 'Î∏îÎûô', category: 'Classic', sizes: [5,6,7,8,9,10], imageUrl: 'https://drive.google.com/thumbnail?id=1GNoNbKu_5w8-m2Ugt0KbKSgq8iiaM33R&sz=w1000' },
    ];

    const CATEGORY_COLORS = {
      'Classic': { bg: '#FDF6E9', border: '#D4A574', badge: '#8B5A2B' },
      'Platform': { bg: '#F0E6F5', border: '#9B6FA8', badge: '#6B4C78' },
      'Slipper': { bg: '#E6F0F5', border: '#6A9BB5', badge: '#3D6B85' },
    };

    // XLSX Download Function (English + Enhanced Design)
    const downloadXLSX = (orders, clientName, clientContact, orderDate, notes, senderAddress, receiverAddress) => {
      const orderSummary = {};
      Object.values(orders).forEach(item => {
        if (!orderSummary[item.sku]) orderSummary[item.sku] = [];
        orderSummary[item.sku].push({ size: item.size, qty: item.qty });
      });

      const totalItems = Object.values(orders).reduce((sum, item) => sum + item.qty, 0);
      const wb = XLSX.utils.book_new();
      const data = [];
      
      // Title
      data.push(['UGG ORDER FORM']);
      data.push([]);
      
      // Client Information Section
      data.push(['CLIENT INFORMATION']);
      data.push(['Client Name', clientName || '-', '', 'Contact', clientContact || '-']);
      data.push(['Order Date', orderDate, '', 'Notes', notes || '-']);
      data.push([]);
      
      // Shipping Information Section
      data.push(['SHIPPING INFORMATION']);
      data.push(['Sender Address', senderAddress || '-']);
      data.push(['Receiver Address', receiverAddress || '-']);
      data.push([]);
      
      // Order Details Section
      data.push(['ORDER DETAILS']);
      data.push(['No.', 'SKU', 'Product Name', 'Category', 'Color', 'Size', 'Qty']);
      
      let rowNum = 1;
      Object.entries(orderSummary).forEach(([sku, items]) => {
        const product = UGG_PRODUCTS.find(p => p.sku === sku);
        items.forEach(item => {
          const sizeDisplay = `US ${item.size} (${US_TO_KR[item.size]}mm)`;
          data.push([
            rowNum++,
            sku,
            product?.name || '',
            product?.category || '',
            product?.color || '',
            sizeDisplay,
            item.qty
          ]);
        });
      });
      
      data.push([]);
      data.push(['', '', '', '', '', 'TOTAL QUANTITY', totalItems]);
      data.push([]);
      
      // Product Summary Section
      data.push(['PRODUCT SUMMARY']);
      data.push(['SKU', 'Product Name', 'Color', 'Size √ó Qty', 'Subtotal']);
      
      Object.entries(orderSummary).forEach(([sku, items]) => {
        const product = UGG_PRODUCTS.find(p => p.sku === sku);
        const sizeQtyStr = items.map(i => `US ${i.size} (${US_TO_KR[i.size]}mm) √ó ${i.qty}`).join(', ');
        const subtotal = items.reduce((sum, i) => sum + i.qty, 0);
        data.push([
          sku,
          product?.name || '',
          product?.color || '',
          sizeQtyStr,
          subtotal
        ]);
      });
      
      data.push([]);
      data.push(['', '', '', 'GRAND TOTAL', totalItems]);

      const ws = XLSX.utils.aoa_to_sheet(data);
      
      // Column Width Settings
      ws['!cols'] = [
        { wch: 6 },   // No.
        { wch: 18 },  // SKU
        { wch: 32 },  // Product Name
        { wch: 12 },  // Category
        { wch: 12 },  // Color
        { wch: 25 },  // Size
        { wch: 10 },  // Qty
      ];
      
      // Calculate dynamic row positions
      const titleRow = 0;
      const clientInfoHeaderRow = 2;
      const clientInfoRows = [3, 4];
      const shippingInfoHeaderRow = 6;
      const shippingInfoRows = [7, 8];
      const orderDetailHeaderRow = 10;
      const orderDetailColumnHeaderRow = 11;
      const orderDetailStartRow = 12;
      const orderDetailEndRow = orderDetailStartRow + Object.values(orderSummary).flat().length - 1;
      const orderTotalRow = orderDetailEndRow + 2;
      const summaryHeaderRow = orderTotalRow + 2;
      const summaryColumnHeaderRow = summaryHeaderRow + 1;
      const summaryStartRow = summaryColumnHeaderRow + 1;
      const summaryEndRow = summaryStartRow + Object.keys(orderSummary).length - 1;
      const grandTotalRow = summaryEndRow + 2;
      
      // Cell Merges
      ws['!merges'] = [
        // Title
        { s: { r: titleRow, c: 0 }, e: { r: titleRow, c: 6 } },
        // Section Headers
        { s: { r: clientInfoHeaderRow, c: 0 }, e: { r: clientInfoHeaderRow, c: 6 } },
        { s: { r: shippingInfoHeaderRow, c: 0 }, e: { r: shippingInfoHeaderRow, c: 6 } },
        { s: { r: orderDetailHeaderRow, c: 0 }, e: { r: orderDetailHeaderRow, c: 6 } },
        { s: { r: summaryHeaderRow, c: 0 }, e: { r: summaryHeaderRow, c: 6 } },
        // Shipping info values
        { s: { r: 7, c: 1 }, e: { r: 7, c: 6 } },
        { s: { r: 8, c: 1 }, e: { r: 8, c: 6 } },
      ];
      
      // Enhanced Styling
      // Title Style (Dark Blue, Large)
      const titleCell = XLSX.utils.encode_cell({ r: titleRow, c: 0 });
      ws[titleCell].s = {
        font: { bold: true, sz: 18, color: { rgb: "FFFFFF" } },
        fill: { fgColor: { rgb: "1F4E78" } },
        alignment: { horizontal: "center", vertical: "center" }
      };
      
      // Section Header Style (Blue)
      const sectionHeaders = [clientInfoHeaderRow, shippingInfoHeaderRow, orderDetailHeaderRow, summaryHeaderRow];
      sectionHeaders.forEach(row => {
        for (let col = 0; col <= 6; col++) {
          const cellRef = XLSX.utils.encode_cell({ r: row, c: col });
          if (!ws[cellRef]) ws[cellRef] = { t: 's', v: '' };
          ws[cellRef].s = {
            font: { bold: true, sz: 12, color: { rgb: "FFFFFF" } },
            fill: { fgColor: { rgb: "4472C4" } },
            alignment: { horizontal: "center", vertical: "center" }
          };
        }
      });
      
      // Column Header Style (Light Blue)
      [orderDetailColumnHeaderRow, summaryColumnHeaderRow].forEach(row => {
        for (let col = 0; col <= 6; col++) {
          const cellRef = XLSX.utils.encode_cell({ r: row, c: col });
          if (ws[cellRef]) {
            ws[cellRef].s = {
              font: { bold: true, sz: 11, color: { rgb: "000000" } },
              fill: { fgColor: { rgb: "D9E2F3" } },
              alignment: { horizontal: "center", vertical: "center" },
              border: {
                top: { style: "thin", color: { rgb: "4472C4" } },
                bottom: { style: "thin", color: { rgb: "4472C4" } },
                left: { style: "thin", color: { rgb: "4472C4" } },
                right: { style: "thin", color: { rgb: "4472C4" } }
              }
            };
          }
        }
      });
      
      // Info Row Labels Style (Bold)
      [...clientInfoRows, ...shippingInfoRows].forEach(row => {
        const labelCell = XLSX.utils.encode_cell({ r: row, c: 0 });
        if (ws[labelCell]) {
          ws[labelCell].s = {
            font: { bold: true, sz: 10 },
            fill: { fgColor: { rgb: "F2F2F2" } },
            alignment: { horizontal: "left", vertical: "center" }
          };
        }
      });
      
      // Total Row Style (Bold, Yellow Background)
      [orderTotalRow, grandTotalRow].forEach(row => {
        for (let col = 0; col <= 6; col++) {
          const cellRef = XLSX.utils.encode_cell({ r: row, c: col });
          if (ws[cellRef]) {
            ws[cellRef].s = {
              font: { bold: true, sz: 11 },
              fill: { fgColor: { rgb: "FFF2CC" } },
              alignment: { horizontal: col >= 5 ? "center" : "left", vertical: "center" },
              border: {
                top: { style: "medium", color: { rgb: "000000" } },
                bottom: { style: "medium", color: { rgb: "000000" } }
              }
            };
          }
        }
      });
      
      // Data Row Borders (Light)
      for (let row = orderDetailStartRow; row <= orderDetailEndRow; row++) {
        for (let col = 0; col <= 6; col++) {
          const cellRef = XLSX.utils.encode_cell({ r: row, c: col });
          if (ws[cellRef]) {
            ws[cellRef].s = {
              alignment: { horizontal: col === 0 || col >= 5 ? "center" : "left", vertical: "center" },
              border: {
                top: { style: "thin", color: { rgb: "D0D0D0" } },
                bottom: { style: "thin", color: { rgb: "D0D0D0" } },
                left: { style: "thin", color: { rgb: "D0D0D0" } },
                right: { style: "thin", color: { rgb: "D0D0D0" } }
              }
            };
          }
        }
      }
      
      // Summary Row Borders
      for (let row = summaryStartRow; row <= summaryEndRow; row++) {
        for (let col = 0; col <= 4; col++) {
          const cellRef = XLSX.utils.encode_cell({ r: row, c: col });
          if (ws[cellRef]) {
            ws[cellRef].s = {
              alignment: { horizontal: col === 4 ? "center" : "left", vertical: "center" },
              border: {
                top: { style: "thin", color: { rgb: "D0D0D0" } },
                bottom: { style: "thin", color: { rgb: "D0D0D0" } },
                left: { style: "thin", color: { rgb: "D0D0D0" } },
                right: { style: "thin", color: { rgb: "D0D0D0" } }
              }
            };
          }
        }
      }

      XLSX.utils.book_append_sheet(wb, ws, 'Order Form');
      const fileName = `UGG_Order_${clientName || 'Client'}_${orderDate}.xlsx`;
      XLSX.writeFile(wb, fileName);
    };

    function UGGOrderForm() {
      const [language, setLanguage] = useState('ko');
      const [adminMode, setAdminMode] = useState(false);
      const [orders, setOrders] = useState({});
      const [images, setImages] = useState({});
      const [clientName, setClientName] = useState('');
      const [clientContact, setClientContact] = useState('');
      const [orderDate, setOrderDate] = useState(new Date().toISOString().split('T')[0]);
      const [notes, setNotes] = useState('');
      const [senderAddress, setSenderAddress] = useState('');
      const [receiverAddress, setReceiverAddress] = useState('');
      const [showShareModal, setShowShareModal] = useState(false);
      const [shareUrl, setShareUrl] = useState('');
      const [copied, setCopied] = useState(false);
      const [imageViewModal, setImageViewModal] = useState(null);
      const fileInputRefs = useRef({});
      
      const [orderHistory, setOrderHistory] = useState([]);
      const [showHistoryModal, setShowHistoryModal] = useState(false);
      const [selectedCategory, setSelectedCategory] = useState('ALL');
      const [showAllInOne, setShowAllInOne] = useState(false);

      const t = TRANSLATIONS[language];

      // Ï†úÌíà Ïù¥ÎØ∏ÏßÄ Ï¥àÍ∏∞Ìôî
      useEffect(() => {
        const defaultImages = {};
        UGG_PRODUCTS.forEach(product => {
          if (product.imageUrl) {
            defaultImages[product.sku] = product.imageUrl;
          }
        });
        setImages(prev => ({ ...defaultImages, ...prev }));
      }, []);

      // localStorage ÌûàÏä§ÌÜ†Î¶¨ Î°úÎìú
      const loadHistory = () => {
        try {
          const stored = localStorage.getItem('ugg-order-history');
          if (stored) {
            const parsed = JSON.parse(stored);
            parsed.sort((a, b) => new Date(b.savedAt) - new Date(a.savedAt));
            setOrderHistory(parsed);
          }
        } catch (e) {
          console.error('Failed to load history:', e);
          setOrderHistory([]);
        }
      };

      // Ï£ºÎ¨∏ Ï†ÄÏû•
      const saveToHistory = () => {
        if (getTotalItems() === 0) {
          alert('Ï£ºÎ¨∏ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.');
          return;
        }
        
        const orderData = {
          id: Date.now(),
          orders,
          images,
          clientName,
          clientContact,
          orderDate,
          notes,
          senderAddress,
          receiverAddress,
          totalItems: getTotalItems(),
          savedAt: new Date().toISOString(),
        };
        
        try {
          const stored = localStorage.getItem('ugg-order-history');
          const history = stored ? JSON.parse(stored) : [];
          history.unshift(orderData);
          // ÏµúÎåÄ 50Í∞ú Ïú†ÏßÄ
          if (history.length > 50) history.pop();
          localStorage.setItem('ugg-order-history', JSON.stringify(history));
          alert('Ï£ºÎ¨∏Ïù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
          loadHistory();
        } catch (e) {
          console.error('Failed to save order:', e);
          alert('Ï†ÄÏû•Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
        }
      };

      // ÌûàÏä§ÌÜ†Î¶¨ÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞
      const loadFromHistory = (historyItem) => {
        setOrders(historyItem.orders || {});
        setImages(historyItem.images || {});
        setClientName(historyItem.clientName || '');
        setClientContact(historyItem.clientContact || '');
        setOrderDate(historyItem.orderDate || new Date().toISOString().split('T')[0]);
        setNotes(historyItem.notes || '');
        setSenderAddress(historyItem.senderAddress || '');
        setReceiverAddress(historyItem.receiverAddress || '');
        setShowHistoryModal(false);
      };

      // ÌûàÏä§ÌÜ†Î¶¨ ÏÇ≠Ï†ú
      const deleteFromHistory = (id, e) => {
        e.stopPropagation();
        if (confirm('Ïù¥ Ï£ºÎ¨∏ Í∏∞Î°ùÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
          try {
            const stored = localStorage.getItem('ugg-order-history');
            const history = stored ? JSON.parse(stored) : [];
            const filtered = history.filter(item => item.id !== id);
            localStorage.setItem('ugg-order-history', JSON.stringify(filtered));
            loadHistory();
          } catch (e) {
            console.error('Failed to delete:', e);
          }
        }
      };

      // URLÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Î°úÎìú
      useEffect(() => {
        loadHistory();
        
        const params = new URLSearchParams(window.location.search);
        const data = params.get('data');
        if (data) {
          try {
            const decoded = JSON.parse(decodeURIComponent(escape(atob(data))));
            if (decoded.orders) setOrders(decoded.orders);
            if (decoded.images) setImages(decoded.images);
            if (decoded.clientName) setClientName(decoded.clientName);
            if (decoded.clientContact) setClientContact(decoded.clientContact);
            if (decoded.orderDate) setOrderDate(decoded.orderDate);
            if (decoded.notes) setNotes(decoded.notes);
            if (decoded.senderAddress) setSenderAddress(decoded.senderAddress);
            if (decoded.receiverAddress) setReceiverAddress(decoded.receiverAddress);
          } catch (e) {
            console.error('Failed to parse URL data');
          }
        }
      }, []);

      const handleImageUpload = async (sku, event) => {
        const file = event.target.files[0];
        if (file) {
          if (file.size > 5 * 1024 * 1024) {
            alert('Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞Îäî 5MB Ïù¥ÌïòÎ°ú ÏóÖÎ°úÎìúÌï¥Ï£ºÏÑ∏Ïöî.');
            return;
          }
          
          // Î°úÏª¨ÏóêÏÑú ÎØ∏Î¶¨Î≥¥Í∏∞
          const reader = new FileReader();
          reader.onloadend = () => {
            const img = new Image();
            img.onload = () => {
              const canvas = document.createElement('canvas');
              const targetWidth = 400;
              const targetHeight = 267;
              
              let width = img.width;
              let height = img.height;
              
              const ratio = Math.min(targetWidth / width, targetHeight / height);
              const newWidth = Math.round(width * ratio);
              const newHeight = Math.round(height * ratio);
              
              canvas.width = newWidth;
              canvas.height = newHeight;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0, newWidth, newHeight);
              
              const resizedBase64 = canvas.toDataURL('image/jpeg', 0.85);
              setImages(prev => ({ ...prev, [sku]: resizedBase64 }));
              
              // Í¥ÄÎ¶¨Ïûê Î™®ÎìúÏùº Îïå ÏïàÎÇ¥ Î©îÏãúÏßÄ
              if (adminMode) {
                const productInfo = UGG_PRODUCTS.find(p => p.sku === sku);
                const message = `
üìå Í¥ÄÎ¶¨Ïûê Î™®Îìú: Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Î∞©Î≤ï

1. Ïù¥ Ïù¥ÎØ∏ÏßÄÎ•º Îã§Ïö¥Î°úÎìúÌïòÏÑ∏Ïöî (Ïö∞ÌÅ¥Î¶≠ > Îã§Î•∏ Ïù¥Î¶ÑÏúºÎ°ú Ï†ÄÏû•)
2. ÌÑ∞ÎØ∏ÎÑêÏóêÏÑú Î™ÖÎ†πÏñ¥ Ïã§Ìñâ:
   manus-upload-file /path/to/image.jpg
3. Î∞õÏùÄ URLÏùÑ ÏΩîÎìúÏóê Ï∂îÍ∞Ä:
   { sku: '${sku}', name: '${productInfo?.name}', imageUrl: 'YOUR_URL_HERE' }

ÎòêÎäî Ïù¥ÎØ∏ÏßÄÎ•º Google Drive/Imgur Îì±Ïóê ÏóÖÎ°úÎìúÌïòÍ≥† Í≥µÍ∞ú URLÏùÑ ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.
                `;
                console.log(message);
                alert('Ïù¥ÎØ∏ÏßÄÍ∞Ä Î°úÏª¨Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§. ÏΩòÏÜîÏùÑ ÌôïÏù∏ÌïòÏó¨ ÏóÖÎ°úÎìú Î∞©Î≤ïÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
              }
            };
            img.src = reader.result;
          };
          reader.readAsDataURL(file);
        }
      };

      const removeImage = (sku, e) => {
        e.stopPropagation();
        setImages(prev => {
          const newImages = { ...prev };
          delete newImages[sku];
          return newImages;
        });
      };

      const toggleSize = (sku, size) => {
        setOrders(prev => {
          const key = `${sku}-${size}`;
          const newOrders = { ...prev };
          if (newOrders[key]) {
            delete newOrders[key];
          } else {
            newOrders[key] = { sku, size, qty: 1 };
          }
          return newOrders;
        });
      };

      const updateQty = (sku, size, qty) => {
        const key = `${sku}-${size}`;
        if (qty <= 0) {
          setOrders(prev => {
            const newOrders = { ...prev };
            delete newOrders[key];
            return newOrders;
          });
        } else {
          setOrders(prev => ({
            ...prev,
            [key]: { sku, size, qty: parseInt(qty) || 1 }
          }));
        }
      };

      const isSelected = (sku, size) => !!orders[`${sku}-${size}`];
      const getQty = (sku, size) => orders[`${sku}-${size}`]?.qty || 1;

      const generateShareUrl = () => {
        const data = { orders, images, clientName, clientContact, orderDate, notes, senderAddress, receiverAddress };
        const jsonStr = JSON.stringify(data);
        
        if (jsonStr.length > 50000) {
          alert('Ïù¥ÎØ∏ÏßÄÍ∞Ä ÎÑàÎ¨¥ ÎßéÍ±∞ÎÇò ÌÅΩÎãàÎã§. ÏùºÎ∂Ä Ïù¥ÎØ∏ÏßÄÎ•º ÏÇ≠Ï†úÌïòÍ±∞ÎÇò Îçî ÏûëÏùÄ Ïù¥ÎØ∏ÏßÄÎ•º ÏÇ¨Ïö©Ìï¥Ï£ºÏÑ∏Ïöî.');
          return;
        }
        
        const encoded = btoa(unescape(encodeURIComponent(jsonStr)));
        const url = `${window.location.origin}${window.location.pathname}?data=${encoded}`;
        setShareUrl(url);
        setShowShareModal(true);
      };

      const copyToClipboard = () => {
        navigator.clipboard.writeText(shareUrl);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      };

      const getTotalItems = () => {
        return Object.values(orders).reduce((sum, item) => sum + item.qty, 0);
      };

      const getOrderSummary = () => {
        const summary = {};
        Object.values(orders).forEach(item => {
          if (!summary[item.sku]) summary[item.sku] = [];
          summary[item.sku].push({ size: item.size, qty: item.qty });
        });
        return summary;
      };

      const deleteOrderItem = (sku) => {
        if (confirm('Ïù¥ Ï†úÌíàÏùò Î™®Îì† Ï£ºÎ¨∏ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
          setOrders(prev => {
            const newOrders = { ...prev };
            Object.keys(newOrders).forEach(key => {
              if (key.startsWith(sku + '-')) {
                delete newOrders[key];
              }
            });
            return newOrders;
          });
          setImages(prev => {
            const newImages = { ...prev };
            delete newImages[sku];
            return newImages;
          });
        }
      };

      const clearAll = () => {
        setOrders({});
        setImages({});
        setClientName('');
        setClientContact('');
        setNotes('');
        setSenderAddress('');
        setReceiverAddress('');
      };

      const printOrder = () => {
        window.print();
      };

      const groupedProducts = UGG_PRODUCTS.reduce((acc, product) => {
        if (!acc[product.category]) acc[product.category] = [];
        acc[product.category].push(product);
        return acc;
      }, {});

      return (
        <div>
          {/* Ìó§Îçî */}
          <div style={{
            maxWidth: '1200px',
            margin: '0 auto 24px',
            display: 'flex',
            justifyContent: 'space-between',
            alignItems: 'center',
            flexWrap: 'wrap',
            gap: '16px',
          }}>
            <div>
              <div style={{ display: 'flex', alignItems: 'center', gap: '16px', flexWrap: 'wrap' }}>
                <h1 style={{
                  fontSize: '28px',
                  fontWeight: '800',
                  color: '#1a1a1a',
                  margin: 0,
                  letterSpacing: '-0.5px',
                }}>
                  {t.title}
                </h1>
                <div className="no-print" style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>
                  <button 
                    onClick={() => setLanguage('ko')}
                    style={{
                      background: 'none',
                      border: 'none',
                      fontSize: '18px',
                      fontWeight: '700',
                      color: language === 'ko' ? '#E74C3C' : '#999',
                      cursor: 'pointer',
                      padding: '4px 8px',
                      transition: 'all 0.2s',
                    }}
                  >
                    KO
                  </button>
                  <button 
                    onClick={() => setLanguage('en')}
                    style={{
                      background: 'none',
                      border: 'none',
                      fontSize: '18px',
                      fontWeight: '700',
                      color: language === 'en' ? '#E74C3C' : '#999',
                      cursor: 'pointer',
                      padding: '4px 8px',
                      transition: 'all 0.2s',
                    }}
                  >
                    ENG
                  </button>
                  <button 
                    onClick={() => setLanguage('cn')}
                    style={{
                      background: 'none',
                      border: 'none',
                      fontSize: '18px',
                      fontWeight: '700',
                      color: language === 'cn' ? '#E74C3C' : '#999',
                      cursor: 'pointer',
                      padding: '4px 8px',
                      transition: 'all 0.2s',
                    }}
                  >
                    CN
                  </button>
                </div>
              </div>
              <p style={{ color: '#666', margin: '4px 0 0', fontSize: '14px' }}>
                {t.subtitle} ¬∑ üì∑ {t.imageUpload}
              </p>
            </div>
            
            <div className="no-print" style={{ display: 'flex', gap: '12px', flexWrap: 'wrap' }}>
              <button className="btn-secondary" onClick={clearAll}>
                üóëÔ∏è {t.reset}
              </button>
              <button className="btn-secondary" onClick={() => { loadHistory(); setShowHistoryModal(true); }}>
                üìã {t.history} ({orderHistory.length})
              </button>
              <button 
                className="btn-secondary" 
                onClick={saveToHistory}
                disabled={getTotalItems() === 0}
                style={{ opacity: getTotalItems() === 0 ? 0.5 : 1 }}
              >
                üíæ {t.save}
              </button>
              <button className="btn-secondary" onClick={printOrder}>
                üñ®Ô∏è {t.print}
              </button>
              <button 
                className="btn-secondary" 
                onClick={() => downloadXLSX(orders, clientName, clientContact, orderDate, notes, senderAddress, receiverAddress)}
                disabled={getTotalItems() === 0}
                style={{ opacity: getTotalItems() === 0 ? 0.5 : 1 }}
              >
                üì• {t.excel}
              </button>
              <button className="btn-primary" onClick={generateShareUrl}>
                üîó {t.share}
              </button>
              <button 
                className={adminMode ? "btn-primary" : "btn-secondary"}
                onClick={() => setAdminMode(!adminMode)}
                style={{ 
                  background: adminMode ? 'linear-gradient(135deg, #E74C3C 0%, #C0392B 100%)' : undefined,
                  fontWeight: adminMode ? '700' : '600'
                }}
              >
                {adminMode ? 'üîì Í¥ÄÎ¶¨Ïûê Î™®Îìú' : 'üîí Í¥ÄÎ¶¨Ïûê'}
              </button>
            </div>
          </div>

          {/* Í±∞ÎûòÏ≤ò Ï†ïÎ≥¥ */}
          <div style={{
            maxWidth: '1200px',
            margin: '0 auto 24px',
            background: 'white',
            borderRadius: '16px',
            padding: '24px',
            boxShadow: '0 2px 8px rgba(0,0,0,0.04)',
          }}>
            <h2 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '16px', color: '#333' }}>
              üìã {t.clientInfo}
            </h2>
            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '16px' }}>
              <div>
                <label style={{ fontSize: '13px', fontWeight: '600', color: '#666', display: 'block', marginBottom: '6px' }}>
                  {t.clientName}
                </label>
                <input
                  type="text"
                  className="input-field"
                  value={clientName}
                  onChange={(e) => setClientName(e.target.value)}
                  placeholder={t.enterClientName}
                />
              </div>
              <div>
                <label style={{ fontSize: '13px', fontWeight: '600', color: '#666', display: 'block', marginBottom: '6px' }}>
                  {t.contact}
                </label>
                <input
                  type="text"
                  className="input-field"
                  value={clientContact}
                  onChange={(e) => setClientContact(e.target.value)}
                  placeholder={t.enterContact}
                />
              </div>
              <div>
                <label style={{ fontSize: '13px', fontWeight: '600', color: '#666', display: 'block', marginBottom: '6px' }}>
                  {t.orderDate}
                </label>
                <input
                  type="date"
                  className="input-field"
                  value={orderDate}
                  onChange={(e) => setOrderDate(e.target.value)}
                />
              </div>
              <div>
                <label style={{ fontSize: '13px', fontWeight: '600', color: '#666', display: 'block', marginBottom: '6px' }}>
                  {t.notes}
                </label>
                <input
                  type="text"
                  className="input-field"
                  value={notes}
                  onChange={(e) => setNotes(e.target.value)}
                  placeholder={t.enterNotes}
                />
              </div>
            </div>
            
            <div style={{ marginTop: '20px', paddingTop: '20px', borderTop: '1px solid #eee' }}>
              <h3 style={{ fontSize: '14px', fontWeight: '700', marginBottom: '12px', color: '#333' }}>
                üöö {t.shipping}
              </h3>
              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', gap: '16px' }}>
                <div>
                  <label style={{ fontSize: '13px', fontWeight: '600', color: '#666', display: 'block', marginBottom: '6px' }}>
                    üì§ {t.sender}
                  </label>
                  <textarea
                    className="input-field"
                    value={senderAddress}
                    onChange={(e) => setSenderAddress(e.target.value)}
                    placeholder={t.enterSender}
                    rows={2}
                    style={{ resize: 'vertical', minHeight: '60px' }}
                  />
                </div>
                <div>
                  <label style={{ fontSize: '13px', fontWeight: '600', color: '#666', display: 'block', marginBottom: '6px' }}>
                    üì• {t.receiver}
                  </label>
                  <textarea
                    className="input-field"
                    value={receiverAddress}
                    onChange={(e) => setReceiverAddress(e.target.value)}
                    placeholder={t.enterReceiver}
                    rows={2}
                    style={{ resize: 'vertical', minHeight: '60px' }}
                  />
                </div>
              </div>
            </div>
          </div>

          {/* Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ Ïä§ÏúÑÏπò (PCÎßå) */}
          <div className="no-print" style={{ maxWidth: '1200px', margin: '0 auto 24px', display: 'none' }} id="category-filter">
            <style>{`
              @media (min-width: 768px) {
                #category-filter { display: block !important; }
              }
            `}</style>
            <div style={{ 
              display: 'flex', 
              gap: '12px', 
              alignItems: 'center',
              flexWrap: 'wrap',
              padding: '16px',
              background: '#f8f9fa',
              borderRadius: '12px',
              border: '1px solid #e0e0e0'
            }}>
              <span style={{ fontWeight: '600', color: '#555', marginRight: '8px' }}>Ïπ¥ÌÖåÍ≥†Î¶¨:</span>
              {['ALL', 'Slipper', 'Platform', 'Classic'].map(cat => (
                <button
                  key={cat}
                  onClick={() => setSelectedCategory(cat)}
                  style={{
                    padding: '8px 20px',
                    borderRadius: '20px',
                    border: selectedCategory === cat ? '2px solid #4472C4' : '2px solid #ddd',
                    background: selectedCategory === cat ? '#4472C4' : 'white',
                    color: selectedCategory === cat ? 'white' : '#555',
                    fontWeight: selectedCategory === cat ? '700' : '500',
                    cursor: 'pointer',
                    transition: 'all 0.2s',
                    fontSize: '14px'
                  }}
                >
                  {cat === 'ALL' ? 'Ï†ÑÏ≤¥' : cat}
                </button>
              ))}
              <div style={{ width: '1px', height: '24px', background: '#ddd', margin: '0 8px' }} />
              <button
                onClick={() => setShowAllInOne(!showAllInOne)}
                style={{
                  padding: '8px 20px',
                  borderRadius: '20px',
                  border: showAllInOne ? '2px solid #E74C3C' : '2px solid #ddd',
                  background: showAllInOne ? '#E74C3C' : 'white',
                  color: showAllInOne ? 'white' : '#555',
                  fontWeight: showAllInOne ? '700' : '500',
                  cursor: 'pointer',
                  transition: 'all 0.2s',
                  fontSize: '14px'
                }}
              >
                {showAllInOne ? 'Ìïú ÌôîÎ©¥ Î≥¥Í∏∞ ON' : 'Ìïú ÌôîÎ©¥ Î≥¥Í∏∞ OFF'}
              </button>
            </div>
          </div>

          {/* Ïπ¥ÌÖåÍ≥†Î¶¨Î≥Ñ Ï†úÌíà */}
          <div style={{ maxWidth: showAllInOne ? '100%' : '1200px', margin: '0 auto' }}>
            {Object.entries(groupedProducts)
              .filter(([category]) => selectedCategory === 'ALL' || category === selectedCategory)
              .map(([category, products]) => (
              <div key={category} style={{ marginBottom: '32px' }}>
                <div style={{
                  display: 'flex',
                  alignItems: 'center',
                  gap: '12px',
                  marginBottom: '16px',
                }}>
                  <span style={{
                    background: CATEGORY_COLORS[category].badge,
                    color: 'white',
                    padding: '6px 16px',
                    borderRadius: '20px',
                    fontSize: '14px',
                    fontWeight: '700',
                  }}>
                    {category}
                  </span>
                  <div style={{ flex: 1, height: '2px', background: CATEGORY_COLORS[category].border, opacity: 0.3 }} />
                </div>

                <div style={{ 
                  display: 'grid', 
                  gridTemplateColumns: showAllInOne ? 'repeat(auto-fill, minmax(280px, 1fr))' : 'repeat(auto-fill, minmax(320px, 440px))', 
                  gap: showAllInOne ? '16px' : '20px', 
                  justifyContent: 'center' 
                }}>
                  {products.map(product => {
                    const productOrders = Object.values(orders).filter(o => o.sku === product.sku);
                    const totalQty = productOrders.reduce((sum, o) => sum + o.qty, 0);
                    const hasImage = !!images[product.sku];
                    
                    return (
                      <div
                        key={product.sku}
                        className="product-card"
                        style={{
                          background: CATEGORY_COLORS[category].bg,
                          border: `2px solid ${CATEGORY_COLORS[category].border}`,
                          borderRadius: '16px',
                          padding: '20px',
                          position: 'relative',
                        }}
                      >
                        {totalQty > 0 && (
                          <div style={{
                            position: 'absolute',
                            top: '-10px',
                            right: '-10px',
                            background: '#E74C3C',
                            color: 'white',
                            width: '32px',
                            height: '32px',
                            borderRadius: '50%',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            fontWeight: '700',
                            fontSize: '14px',
                            boxShadow: '0 2px 8px rgba(231,76,60,0.4)',
                            zIndex: 10,
                          }}>
                            {totalQty}
                          </div>
                        )}

                        <div 
                          className={`image-upload-zone ${hasImage ? 'has-image' : ''}`}
                          onClick={() => !hasImage && fileInputRefs.current[product.sku]?.click()}
                          style={{ position: 'relative' }}
                        >
                          <input
                            type="file"
                            accept="image/*"
                            ref={el => fileInputRefs.current[product.sku] = el}
                            onChange={(e) => handleImageUpload(product.sku, e)}
                            style={{ display: 'none' }}
                          />
                          {hasImage ? (
                            <>
                              <img 
                                src={images[product.sku]} 
                                alt={product.name}
                                className="product-image"
                                onClick={(e) => {
                                  e.stopPropagation();
                                  setImageViewModal(images[product.sku]);
                                }}
                              />
                              <button 
                                className="remove-image-btn no-print"
                                onClick={(e) => removeImage(product.sku, e)}
                                title="Ïù¥ÎØ∏ÏßÄ ÏÇ≠Ï†ú"
                              >
                                ‚úï
                              </button>
                            </>
                          ) : (
                            <div className="no-print" style={{ padding: '8px 0' }}>
                              <div style={{ fontSize: '24px', marginBottom: '4px' }}>üì∑</div>
                              <div style={{ fontSize: '12px', color: '#888' }}>{t.clickToAddPhoto}</div>
                            </div>
                          )}
                        </div>

                        <div style={{ marginBottom: '12px' }}>
                          <div style={{ fontSize: '13px', color: '#888', marginBottom: '4px', fontFamily: 'monospace' }}>
                            {product.sku}
                          </div>
                          <div style={{ fontSize: '18px', fontWeight: '700', color: '#1a1a1a' }}>
                            {product.name}
                          </div>
                          <div style={{
                            display: 'inline-block',
                            marginTop: '6px',
                            padding: '4px 10px',
                            background: product.color === 'Chestnut' ? '#D4A574' : 
                                       product.color === 'Grey' ? '#9E9E9E' : '#333',
                            color: 'white',
                            borderRadius: '12px',
                            fontSize: '12px',
                            fontWeight: '600',
                          }}>
                            {product.color}
                          </div>
                        </div>

                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                          {product.sizes.map(size => {
                            const selected = isSelected(product.sku, size);
                            const krSize = US_TO_KR[size];
                            return (
                              <div key={size} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px' }}>
                                <div
                                  className={`size-btn ${selected ? 'selected' : ''}`}
                                  onClick={() => toggleSize(product.sku, size)}
                                  style={{
                                    width: '60px',
                                    height: '52px',
                                    display: 'flex',
                                    flexDirection: 'column',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    background: 'white',
                                    border: `2px solid ${CATEGORY_COLORS[category].border}`,
                                    borderRadius: '10px',
                                    fontSize: '13px',
                                    fontWeight: '600',
                                    lineHeight: '1.2',
                                  }}
                                >
                                  <span style={{ fontSize: '11px', opacity: 0.7 }}>US {size}</span>
                                  <span style={{ fontSize: '15px' }}>{krSize}</span>
                                </div>
                                {selected && (
                                  <input
                                    type="number"
                                    min="1"
                                    className="qty-input"
                                    value={getQty(product.sku, size)}
                                    onChange={(e) => updateQty(product.sku, size, e.target.value)}
                                    onClick={(e) => e.stopPropagation()}
                                  />
                                )}
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            ))}
          </div>

          {/* Ï£ºÎ¨∏ ÏöîÏïΩ */}
          {getTotalItems() > 0 && (
            <div style={{
              maxWidth: '1200px',
              margin: '32px auto 0',
              background: 'white',
              borderRadius: '16px',
              padding: '24px',
              boxShadow: '0 4px 20px rgba(0,0,0,0.08)',
              border: '2px solid #1a1a1a',
            }}>
              <h2 style={{ fontSize: '18px', fontWeight: '700', marginBottom: '20px', color: '#1a1a1a', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <span>üì¶ {t.orderSummary} <span style={{ color: '#E74C3C' }}>({getTotalItems()}Í∞ú)</span></span>
                <div style={{ display: 'flex', gap: '8px' }}>
                  <button 
                    className="btn-secondary no-print"
                    onClick={saveToHistory}
                    style={{ fontSize: '14px', padding: '10px 20px' }}
                  >
                    üíæ {t.save}
                  </button>
                  <button 
                    className="btn-primary no-print"
                    onClick={() => downloadXLSX(orders, clientName, clientContact, orderDate, notes, senderAddress, receiverAddress)}
                    style={{ fontSize: '14px', padding: '10px 20px' }}
                  >
                    üì• {t.excel}
                  </button>
                </div>
              </h2>
              
              <div style={{ marginBottom: '16px', padding: '12px', background: '#f8f8f8', borderRadius: '8px' }}>
                <div style={{ marginBottom: '8px' }}>
                  <strong>{t.clientName}:</strong> {clientName || '-'} | <strong>{t.contact}:</strong> {clientContact || '-'} | <strong>{t.orderDate}:</strong> {orderDate}
                  {notes && <> | <strong>{t.notes}:</strong> {notes}</>}
                </div>
                {(senderAddress || receiverAddress) && (
                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginTop: '8px', paddingTop: '8px', borderTop: '1px dashed #ddd' }}>
                    <div>
                      <strong>üì§ {t.sender}:</strong> <span style={{ color: '#555' }}>{senderAddress || '-'}</span>
                    </div>
                    <div>
                      <strong>üì• {t.receiver}:</strong> <span style={{ color: '#555' }}>{receiverAddress || '-'}</span>
                    </div>
                  </div>
                )}
              </div>

              <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead>
                  <tr style={{ borderBottom: '2px solid #1a1a1a' }}>
                    <th style={{ textAlign: 'left', padding: '12px 8px', fontSize: '14px', width: '60px' }}>{t.photo}</th>
                    <th style={{ textAlign: 'left', padding: '12px 8px', fontSize: '14px' }}>{t.sku}</th>
                    <th style={{ textAlign: 'left', padding: '12px 8px', fontSize: '14px' }}>{t.productName}</th>
                    <th style={{ textAlign: 'left', padding: '12px 8px', fontSize: '14px' }}>{t.color}</th>
                    <th style={{ textAlign: 'left', padding: '12px 8px', fontSize: '14px' }}>{t.sizeQty}</th>
                    <th style={{ textAlign: 'right', padding: '12px 8px', fontSize: '14px' }}>{t.subtotal}</th>
                    <th className="no-print" style={{ textAlign: 'center', padding: '12px 8px', fontSize: '14px', width: '80px' }}>{t.delete}</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.entries(getOrderSummary()).map(([sku, items]) => {
                    const product = UGG_PRODUCTS.find(p => p.sku === sku);
                    const subtotal = items.reduce((sum, i) => sum + i.qty, 0);
                    return (
                      <tr key={sku} style={{ borderBottom: '1px solid #eee' }}>
                        <td style={{ padding: '8px' }}>
                          {images[sku] ? (
                            <img 
                              src={images[sku]} 
                              alt={product?.name}
                              style={{ width: '50px', height: '50px', objectFit: 'cover', borderRadius: '6px' }}
                            />
                          ) : (
                            <div style={{ 
                              width: '50px', 
                              height: '50px', 
                              background: '#f0f0f0', 
                              borderRadius: '6px',
                              display: 'flex',
                              alignItems: 'center',
                              justifyContent: 'center',
                              fontSize: '20px',
                              color: '#ccc'
                            }}>
                              üì∑
                            </div>
                          )}
                        </td>
                        <td style={{ padding: '12px 8px', fontFamily: 'monospace', fontSize: '13px' }}>{sku}</td>
                        <td style={{ padding: '12px 8px', fontWeight: '600' }}>{product?.name}</td>
                        <td style={{ padding: '12px 8px' }}>{product?.color}</td>
                        <td style={{ padding: '12px 8px' }}>
                          {items.map(i => `${US_TO_KR[i.size]}(${i.qty})`).join(', ')}
                        </td>
                        <td style={{ padding: '12px 8px', textAlign: 'right', fontWeight: '700' }}>{subtotal}</td>
                        <td className="no-print" style={{ padding: '8px', textAlign: 'center' }}>
                          <button 
                            onClick={() => deleteOrderItem(sku)}
                            style={{
                              background: '#ff4444',
                              color: 'white',
                              border: 'none',
                              borderRadius: '6px',
                              padding: '6px 12px',
                              fontSize: '12px',
                              cursor: 'pointer',
                              transition: 'all 0.2s'
                            }}
                            onMouseOver={(e) => e.target.style.background = '#cc0000'}
                            onMouseOut={(e) => e.target.style.background = '#ff4444'}
                          >
                            üóëÔ∏è {t.delete}
                          </button>
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
                <tfoot>
                  <tr style={{ borderTop: '2px solid #1a1a1a', background: '#f8f8f8' }}>
                    <td colSpan={5} style={{ padding: '12px 8px', fontWeight: '700', fontSize: '16px' }}>{t.totalQty}</td>
                    <td style={{ padding: '12px 8px', textAlign: 'right', fontWeight: '800', fontSize: '18px', color: '#E74C3C' }}>
                      {getTotalItems()}
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          )}

          {/* URL Í≥µÏú† Î™®Îã¨ */}
          {showShareModal && (
            <div style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0,0,0,0.5)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 1000,
            }} onClick={() => setShowShareModal(false)}>
              <div style={{
                background: 'white',
                borderRadius: '20px',
                padding: '32px',
                maxWidth: '500px',
                width: '90%',
                boxShadow: '0 20px 60px rgba(0,0,0,0.3)',
              }} onClick={(e) => e.stopPropagation()}>
                <h3 style={{ fontSize: '20px', fontWeight: '700', marginBottom: '16px' }}>
                  üîó Ï£ºÎ¨∏ÏÑú Í≥µÏú† ÎßÅÌÅ¨
                </h3>
                <p style={{ color: '#666', marginBottom: '16px', fontSize: '14px' }}>
                  ÏïÑÎûò URLÏùÑ Í±∞ÎûòÏ≤òÏóê Í≥µÏú†ÌïòÎ©¥ ÎèôÏùºÌïú Ï£ºÎ¨∏ÏÑú(Ïù¥ÎØ∏ÏßÄ Ìè¨Ìï®)Î•º ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.
                </p>
                <div style={{
                  background: '#f5f5f5',
                  padding: '12px',
                  borderRadius: '8px',
                  wordBreak: 'break-all',
                  fontSize: '12px',
                  fontFamily: 'monospace',
                  marginBottom: '16px',
                  maxHeight: '100px',
                  overflow: 'auto',
                }}>
                  {shareUrl}
                </div>
                <div style={{ display: 'flex', gap: '12px' }}>
                  <button className="btn-primary" onClick={copyToClipboard} style={{ flex: 1 }}>
                    {copied ? '‚úÖ Î≥µÏÇ¨Îê®!' : 'üìã Î≥µÏÇ¨ÌïòÍ∏∞'}
                  </button>
                  <button className="btn-secondary" onClick={() => setShowShareModal(false)}>
                    Îã´Í∏∞
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Ïù¥ÎØ∏ÏßÄ ÌôïÎåÄ Î™®Îã¨ */}
          {imageViewModal && (
            <div style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0,0,0,0.85)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 1001,
              cursor: 'pointer',
            }} onClick={() => setImageViewModal(null)}>
              <img 
                src={imageViewModal} 
                alt="ÌôïÎåÄ Ïù¥ÎØ∏ÏßÄ"
                style={{
                  maxWidth: '90%',
                  maxHeight: '90%',
                  borderRadius: '12px',
                  boxShadow: '0 20px 60px rgba(0,0,0,0.5)',
                }}
              />
              <button style={{
                position: 'absolute',
                top: '20px',
                right: '20px',
                background: 'rgba(255,255,255,0.2)',
                color: 'white',
                border: 'none',
                width: '44px',
                height: '44px',
                borderRadius: '50%',
                fontSize: '24px',
                cursor: 'pointer',
              }}>
                ‚úï
              </button>
            </div>
          )}

          {/* ÌûàÏä§ÌÜ†Î¶¨ Î™®Îã¨ */}
          {showHistoryModal && (
            <div style={{
              position: 'fixed',
              top: 0,
              left: 0,
              right: 0,
              bottom: 0,
              background: 'rgba(0,0,0,0.5)',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              zIndex: 1000,
            }} onClick={() => setShowHistoryModal(false)}>
              <div style={{
                background: 'white',
                borderRadius: '20px',
                padding: '32px',
                maxWidth: '600px',
                width: '90%',
                maxHeight: '80vh',
                overflow: 'hidden',
                boxShadow: '0 20px 60px rgba(0,0,0,0.3)',
              }} onClick={(e) => e.stopPropagation()}>
                <h3 style={{ fontSize: '20px', fontWeight: '700', marginBottom: '20px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                  <span>üìã Ï£ºÎ¨∏ ÌûàÏä§ÌÜ†Î¶¨</span>
                  <button 
                    onClick={() => setShowHistoryModal(false)}
                    style={{ background: 'none', border: 'none', fontSize: '24px', cursor: 'pointer', color: '#999' }}
                  >
                    ‚úï
                  </button>
                </h3>
                
                <div style={{ maxHeight: 'calc(80vh - 120px)', overflowY: 'auto' }}>
                  {orderHistory.length === 0 ? (
                    <div style={{ textAlign: 'center', padding: '40px', color: '#888' }}>
                      <div style={{ fontSize: '48px', marginBottom: '12px' }}>üì≠</div>
                      <div>Ï†ÄÏû•Îêú Ï£ºÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.</div>
                    </div>
                  ) : (
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                      {orderHistory.map((item, idx) => (
                        <div 
                          key={item.id}
                          onClick={() => loadFromHistory(item)}
                          style={{
                            padding: '16px',
                            background: '#f8f8f8',
                            borderRadius: '12px',
                            cursor: 'pointer',
                            transition: 'all 0.2s',
                            border: '2px solid transparent',
                            position: 'relative',
                          }}
                          onMouseEnter={(e) => e.currentTarget.style.borderColor = '#D4A574'}
                          onMouseLeave={(e) => e.currentTarget.style.borderColor = 'transparent'}
                        >
                          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                            <div style={{ flex: 1 }}>
                              <div style={{ fontWeight: '700', fontSize: '16px', marginBottom: '6px' }}>
                                {item.clientName || '(Í±∞ÎûòÏ≤òÎ™Ö ÏóÜÏùå)'}
                              </div>
                              <div style={{ fontSize: '13px', color: '#666', marginBottom: '4px' }}>
                                üìÖ Ï£ºÎ¨∏Ïùº: {item.orderDate} | üì¶ ÏàòÎüâ: {item.totalItems}Í∞ú
                              </div>
                              <div style={{ fontSize: '12px', color: '#999' }}>
                                üíæ Ï†ÄÏû•: {new Date(item.savedAt).toLocaleString('ko-KR')}
                              </div>
                              {item.receiverAddress && (
                                <div style={{ fontSize: '12px', color: '#888', marginTop: '4px' }}>
                                  üì• {item.receiverAddress.substring(0, 30)}...
                                </div>
                              )}
                            </div>
                            <button
                              onClick={(e) => deleteFromHistory(item.id, e)}
                              style={{
                                background: '#ff4444',
                                color: 'white',
                                border: 'none',
                                width: '28px',
                                height: '28px',
                                borderRadius: '6px',
                                cursor: 'pointer',
                                fontSize: '14px',
                              }}
                              title="ÏÇ≠Ï†ú"
                            >
                              üóëÔ∏è
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<UGGOrderForm />, document.getElementById('root'));
  </script>
</body>
</html>
